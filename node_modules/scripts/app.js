// 
var gadgetApp = angular.module('gadgetApp', []); 
//Tämä komento hyväksyy localhostista löytyvät tiedostot / koodit / sivustot
gadgetApp.config(function($sceDelegateProvider) {
    $sceDelegateProvider.resourceUrlWhitelist([
        'localhost/**'
    ]);
});

// 
gadgetApp.controller('gadgetListController', function gadgetListController($scope, $http) {

    $scope.method = 'GET';
    $scope.url = '/gadgets';

    //Määritetään editointialueen täyttämiseksi muuttuja
    $scope.editscope = {};
    var editscope = $scope.editscope;

    //Tämä hakee localhostista tällä osoitteella get- kutsun
    $http.get('/gadgets').then(function(response){
      $scope.gadgets = response.data;
    });

    //Delete kutsu
    $scope.delete = function(gadgetnumber) {
      var deleteUrl = '/gadgets/' + gadgetnumber;
      $http.delete(deleteUrl).
        then(function(response) {
          //Kutsun jälkeen täytetään gadgets lista uudestaan
          $scope.gadgets = response.data;
        }, function(response) {
 
      });
    };

    //Tämän funktion avulla täytetään käyttöliittymän inputfieldit editointia varten
    $scope.openEdit = function(gadgetnumber){
      var editUrl = '/gadgets/' + gadgetnumber;
      console.log(editUrl);
      $http.get(editUrl).success(function(data){
        console.log(data[0].Name);
        editscope.name = data[0].Name;
        editscope.description = data[0].Description;
        editscope.latidute = data[0].Latidute;
        editscope.longidute = data[0].Longidute;
        editscope.id = data[0].ID;
      });
    };

    //Post kutsu jolla lisätään uusia gadgetteja
    $scope.addNew = function(){
      console.log($scope.editscope.name);
      console.log($scope.editscope.description);
      console.log($scope.editscope.latidute);
      console.log($scope.editscope.longidute);

      var dataobject = {
        "Name": $scope.editscope.name,
        "Description": $scope.editscope.description,
        "Latidute": $scope.editscope.latidute,
        "Longidute": $scope.editscope.longidute
      };

      var json_object = JSON.stringify(dataobject);

      $http.post('/gadgets', json_object).then(function(response){
        $scope.gadgets = response.data;
      });

    };

    //Put-kutsu jolla päivitetään gadgetteja
    $scope.doEdit = function(){
      console.log($scope.editscope.name);
      console.log($scope.editscope.description);
      console.log($scope.editscope.latidute);
      console.log($scope.editscope.longidute);

      var dataobject = {
        "Name": $scope.editscope.name,
        "Description": $scope.editscope.description,
        "Latidute": $scope.editscope.latidute,
        "Longidute": $scope.editscope.longidute,
        "ID": $scope.editscope.id
      };

      var json_object = JSON.stringify(dataobject);

      $http.put('/gadgets', json_object).then(function(response){
        $scope.gadgets = response.data;
      });

    };

});